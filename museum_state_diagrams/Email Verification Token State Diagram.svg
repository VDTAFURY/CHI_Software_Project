<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="1060px" preserveAspectRatio="none" style="width:890px;height:1060px;background:#FFFFFF;" version="1.1" viewBox="0 0 890 1060" width="890px" zoomAndPan="magnify"><title>**Email Verification Token State Diagram**</title><defs/><g><g class="title" data-source-line="9"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="311.6162" x="282.4341" y="22.9951">Email Verification Token State Diagram</text></g><g id="Generated"><rect fill="#E6E6FA" height="50" rx="12.5" ry="12.5" style="stroke:#800080;stroke-width:0.5;" width="94.2725" x="343" y="180.7969"/><line style="stroke:#800080;stroke-width:0.5;" x1="343" x2="437.2725" y1="207.0938" y2="207.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.2725" x="353" y="198.792">Generated</text></g><g id="Sent"><rect fill="#E6E6FA" height="50" rx="12.5" ry="12.5" style="stroke:#800080;stroke-width:0.5;" width="51.8623" x="99" y="373.7969"/><line style="stroke:#800080;stroke-width:0.5;" x1="99" x2="150.8623" y1="400.0938" y2="400.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.8623" x="109" y="391.792">Sent</text></g><g id="Used"><rect fill="#E6E6FA" height="50" rx="12.5" ry="12.5" style="stroke:#800080;stroke-width:0.5;" width="55.041" x="97.5" y="541.2969"/><line style="stroke:#800080;stroke-width:0.5;" x1="97.5" x2="152.541" y1="567.5938" y2="567.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.041" x="107.5" y="559.292">Used</text></g><g id="Expired"><rect fill="#E6E6FA" height="50" rx="12.5" ry="12.5" style="stroke:#800080;stroke-width:0.5;" width="73.1631" x="425.5" y="541.2969"/><line style="stroke:#800080;stroke-width:0.5;" x1="425.5" x2="498.6631" y1="567.5938" y2="567.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.1631" x="435.5" y="559.292">Expired</text></g><ellipse cx="390" cy="53.2969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><ellipse cx="273" cy="733.7969" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="273" cy="733.7969" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><g class="entity" data-entity="GMN2" data-source-line="35" data-uid="ent0003" id="entity_GMN2"><path d="M642.5,155.2969 L642.5,201.7969 L437.35,205.7969 L642.5,209.7969 L642.5,256.0938 A0,0 0 0 0 642.5,256.0938 L883.4844,256.0938 A0,0 0 0 0 883.4844,256.0938 L883.4844,165.2969 L873.4844,155.2969 L642.5,155.2969 A0,0 0 0 0 642.5,155.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M873.4844,155.2969 L873.4844,165.2969 L883.4844,165.2969 L873.4844,155.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126.1851" x="648.5" y="172.3638">Generated State:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.9844" x="648.5" y="187.4966">- Unique token created (32 chars)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.3716" x="648.5" y="202.6294">- Saved in database</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.7295" x="648.5" y="217.7622">- Linked to user_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.522" x="648.5" y="232.895">- Valid for 24 hours</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.3433" x="648.5" y="248.0278">- Ready to send</text></g><g class="entity" data-entity="GMN5" data-source-line="44" data-uid="ent0006" id="entity_GMN5"><path d="M356.5,348.2969 L356.5,394.7969 L151.02,398.7969 L356.5,402.7969 L356.5,449.0938 A0,0 0 0 0 356.5,449.0938 L585.6587,449.0938 A0,0 0 0 0 585.6587,449.0938 L585.6587,358.2969 L575.6587,348.2969 L356.5,348.2969 A0,0 0 0 0 356.5,348.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M575.6587,348.2969 L575.6587,358.2969 L585.6587,358.2969 L575.6587,348.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82.7544" x="362.5" y="365.3638">Sent State:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.8467" x="362.5" y="380.4966">- Email sent successfully</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.1587" x="362.5" y="395.6294">- Email contains verification link</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.1294" x="362.5" y="410.7622">- Waiting for user click</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.6777" x="362.5" y="425.895">- Can request resend</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.522" x="362.5" y="441.0278">- Valid for 24 hours</text></g><g class="entity" data-entity="GMN8" data-source-line="53" data-uid="ent0009" id="entity_GMN8"><path d="M6,683.2969 L6,784.0938 A0,0 0 0 0 6,784.0938 L186.3389,784.0938 A0,0 0 0 0 186.3389,784.0938 L186.3389,693.2969 L176.3389,683.2969 L108.71,683.2969 L120.78,591.3669 L100.71,683.2969 L6,683.2969 A0,0 0 0 0 6,683.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M176.3389,683.2969 L176.3389,693.2969 L186.3389,693.2969 L176.3389,683.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="85.522" x="12" y="700.3638">Used State:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84.8745" x="12" y="715.4966">- Link clicked</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.3721" x="12" y="730.6294">- Token validity verified</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.3389" x="12" y="745.7622">- User account activated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.8066" x="12" y="760.895">- is_used = true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.3408" x="12" y="776.0278">- Cannot be used again</text></g><g class="entity" data-entity="GMN11" data-source-line="62" data-uid="ent0012" id="entity_GMN11"><path d="M379.5,683.2969 L379.5,784.0938 L626.1973,784.0938 L626.1973,693.2969 L616.1973,683.2969 L379.5,683.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M616.1973,683.2969 L616.1973,693.2969 L626.1973,693.2969 L616.1973,683.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.6665" x="385.5" y="700.3638">Expired State:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.6973" x="385.5" y="715.4966">- 24 hours passed from generation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.3003" x="385.5" y="730.6294">- Token not used</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.1646" x="385.5" y="745.7622">- Cannot be used for verification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.8911" x="385.5" y="760.895">- Can request new token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.3857" x="385.5" y="776.0278">- If 7 days pass &#8594; delete account</text></g><!--link *start* to Generated--><g class="link" data-entity-1=".start." data-entity-2="Generated" data-source-line="11" data-uid="lnk3" id="link_.start._Generated"><path d="M390,63.7069 C390,86.8169 390,140.8869 390,174.7169" fill="none" id="*start*-to-Generated" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="390,180.7169,394,171.7169,390,175.7169,386,171.7169,390,180.7169" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.5962" x="394.1135" y="106.3638">Token created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.8232" x="391" y="121.4966">[user registers]</text></g><!--link Generated to Sent--><g class="link" data-entity-1="Generated" data-entity-2="Sent" data-source-line="18" data-uid="lnk4" id="link_Generated_Sent"><path d="M356.44,230.9869 C302.96,269.5369 204.3775,340.5786 155.9975,375.4486" fill="none" id="Generated-to-Sent" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="151.13,378.9569,160.77,376.9395,155.1862,376.0333,156.0924,370.4495,151.13,378.9569" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.3071" x="299.248" y="299.3638">Email sent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.8032" x="275" y="314.4966">[SMTP successful]</text></g><!--link Generated to Generated--><g class="link" data-entity-1="Generated" data-entity-2="Generated" data-source-line="20" data-uid="lnk5" id="link_Generated_Generated"><path d="M437.19,187.9069 C456.11,186.8969 472,192.8569 472,205.7969 C472,218.7369 462.1015,225.0167 443.1815,224.0067" fill="none" id="Generated-to-Generated" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="437.19,223.6869,445.964,228.1609,442.1829,223.9534,446.3904,220.1723,437.19,223.6869" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.3774" x="489.3052" y="202.8638">Resend requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9878" x="478" y="217.9966">[generate new token]</text></g><!--link Sent to Used--><g class="link" data-entity-1="Sent" data-entity-2="Used" data-source-line="22" data-uid="lnk6" id="link_Sent_Used"><path d="M125,423.8669 C125,455.2369 125,503.8069 125,535.2069" fill="none" id="Sent-to-Used" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="125,541.2069,129,532.2069,125,536.2069,121,532.2069,125,541.2069" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.7065" x="165.2476" y="492.3638">User clicks link</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.2017" x="126" y="507.4966">[token valid &amp; not expired]</text></g><!--link Sent to Expired--><g class="link" data-entity-1="Sent" data-entity-2="Expired" data-source-line="24" data-uid="lnk7" id="link_Sent_Expired"><path d="M151.14,409.9869 C187.35,424.3269 254.57,451.8069 310,479.2969 C350.34,499.2969 389.8622,521.9714 420.2822,540.0514" fill="none" id="Sent-to-Expired" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="425.44,543.1169,419.747,535.0801,421.1419,540.5623,415.6597,541.9571,425.44,543.1169" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.1978" x="371" y="492.3638">Time elapsed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82.3926" x="373.4026" y="507.4966">[&gt; 24 hours]</text></g><!--link Sent to Sent--><g class="link" data-entity-1="Sent" data-entity-2="Sent" data-source-line="26" data-uid="lnk8" id="link_Sent_Sent"><path d="M151.02,382.4669 C168.69,377.6969 186,383.1369 186,398.7969 C186,414.4569 174.4826,421.4606 156.8126,416.6906" fill="none" id="Sent-to-Sent" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="151.02,415.1269,158.6665,421.3342,155.8472,416.43,160.7515,413.6107,151.02,415.1269" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.3774" x="203.3052" y="395.8638">Resend requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9878" x="192" y="410.9966">[generate new token]</text></g><!--link Used to *end*--><g class="link" data-entity-1="Used" data-entity-2=".end." data-source-line="28" data-uid="lnk10" id="link_Used_.end."><path d="M127.44,591.4069 C130.38,609.9869 136.85,635.4569 151,653.2969 C167.58,674.1969 180.53,668.9169 203,683.2969 C225.82,697.8969 246.7602,713.1699 259.7402,722.8499" fill="none" id="Used-to-*end*" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="264.55,726.4369,259.7266,717.85,260.5419,723.4478,254.9441,724.263,264.55,726.4369" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.6792" x="152" y="641.8638">Account activated</text></g><!--link Expired to Generated--><g class="link" data-entity-1="Expired" data-entity-2="Generated" data-source-line="30" data-uid="lnk11" id="link_Expired_Generated"><path d="M498.77,547.2269 C532.92,528.1569 581.61,494.5869 603,449.2969 C622.17,408.7069 624.21,387.8569 603,348.2969 C568.07,283.1569 494.0547,245.0803 442.6747,224.9003" fill="none" id="Expired-to-Generated" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="437.09,222.7069,444.0047,229.7202,441.7439,224.5347,446.9293,222.2739,437.09,222.7069" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.3882" x="652.8521" y="395.8638">New token requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.0923" x="619" y="410.9966">[user requests new verification]</text></g><!--link Expired to *end*--><g class="link" data-entity-1="Expired" data-entity-2=".end." data-source-line="32" data-uid="lnk12" id="link_Expired_.end."><path d="M425.34,570.4869 C390.04,575.4969 337.48,588.3469 306,621.2969 C278.39,650.1969 273.9418,695.0999 273.2518,716.6699" fill="none" id="Expired-to-*end*" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="273.06,722.6669,277.3457,713.7994,273.2199,717.6694,269.3498,713.5436,273.06,722.6669" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.0566" x="336.7546" y="634.3638">Account deleted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.5659" x="307" y="649.4966">[&gt; 7 days no verification]</text></g><!--link Expired to GMN11--><g class="link" data-entity-1="Expired" data-entity-2="GMN11" data-source-line="62" data-uid="lnk13" id="link_Expired_GMN11"><path d="M471.36,591.5269 C474.7,600.7469 478.3,611.4269 481,621.2969 C486.46,641.2869 491.14,663.6269 494.76,683.0469" fill="none" id="Expired-GMN11" style="stroke:#000000;stroke-width:1;stroke-dasharray:7,7;"/></g><g class="legend" data-source-line="70"><rect fill="#DDDDDD" height="238.1563" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:1;" width="336.3066" x="528.1777" y="802.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="108.3359" x="533.1777" y="820.0889">Time Periods:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181.8564" x="533.1777" y="836.3857">&#8226; Token validity: 24 hours</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="326.3066" x="533.1777" y="852.6826">&#8226; Account deletion: 7 days without verification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="533.1777" y="868.9795">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70.9639" x="533.1777" y="885.2764">Security:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="290.8213" x="533.1777" y="901.5732">&#8226; Cryptographically secure random token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.041" x="533.1777" y="917.8701">&#8226; Single use only</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.8721" x="533.1777" y="934.167">&#8226; HTTPS for links</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203.4854" x="533.1777" y="950.4639">&#8226; Hash storage in some apps</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="533.1777" y="966.7607">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="63.6904" x="533.1777" y="983.0576">Resend:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162.873" x="533.1777" y="999.3545">&#8226; Generates new token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.1064" x="533.1777" y="1015.6514">&#8226; Invalidates old token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162.6064" x="533.1777" y="1031.9482">&#8226; Max 3 times per hour</text></g><!--SRC=[ZLNTIXj15BxVfpZqehG1RxHG25HGAofe2IRQ2njat3tP3DdCR6Tcew4KUjK7w2FqqNoIddDs9jcD2BqoER_VzyrtebzeKokdbk232WW_Ce1ZbIzAPnjJdDZAEhXKApG5EavPHn_QyAXnTOKKF7BEFhQnuufwAJGEoeKsTEOG3OLEqxXhBBAVMHPqg106WzEbqXNSejCpdQkWhO69NQ3X6GJeirObmHiCiknkC8MzlKCuGuEESWKCOsdkaBz_CtUDHmSEI-q3EZ_DifRMcqtF6r1-Eo6bnsY2PFX32jxuMCuVKl3qgTOknkFdBDiYOdmyWw2rn3nz8LpZgya8V9FdwFsigQQxFLrErqXD1R7utg1lQPKn3GOV8J1dcY1xk9dnKTyDSyyhdIyyLDeig4zAOQKgNS1RC3O0jfYxxP46gwcN25YfsilMGzZ_07FRY92RyaZlVr4AEExZvnl2KPwJimAeFEYLF46Mzk_gy2LDwIs9Bom1BvjM7UzC- -FwEmkiC4Hc7w5GQ-gtk-qa4eBJvJo0dNMS0kJLBJenvv1S2R07DqOJd8WrUX7U7Un3FbVElvUQCHrH0ThGsg0Ub4U9Nj8pKJXOO5htkf3ehRpNZ6ubwI_XQrJ5ccjP-8p5PwoxYCN135RUgOTpwyYE5Qjr9vTR4vGslYUAc4cAlYeTj2a5MhDncwHErEQPwAyWV8NA3l076u9TCd8vCqOkbkaXPvtQPTZEdMoDhSCwmeqvkGFrmcUSqlw-uU6V8BW64t2-YmS4oQYI-B-ECPqymqn6wo5DDA5MdkVD73N6mo0jE-1vQ-CZi1qKB5Zt2Lv8lBamoLpCafzvApp__XEzdcJe4AgmbBjblmWDEVeHBRE5Rray__gx8_2mwqHEzqwA00uJW4STg2xiee-Ep1l7qpPRJjow3fP-uEivrP8NoPrKGtPMfY3X4aMk7PFpAj47h17NSlHyCXcDHIzsQO9thloS_gDPfqhae_EMEAgwzWbA- -kr1P8ks_UKvSo54H4aPwkYbxjIJt00WGGavSbqh918tOhy3m00]--></g></svg>